#### 响应式系统搭建

> 整个响应式可以拆分成4个部分：数据变化、依赖收集、触发更新、性能优化

##### 一、如何追踪变化

当你把一个普通的 JavaScript对象传入 Vue 实例作为 data 选项，vue 将遍历此对象所有的属性，
并使用 Object.defineProperty 把这些属性全部转为 getter/setter。

这些 getter/setter 对用户来说是不可见的，但是在内部它们让 vue 能够追踪依赖，在属性被访
问和修改时通知变更。

每个组件实例都对应一个 watcher 实例，它会在组件渲染的过程中把“接触”过的数据属性记录
为依赖。之后当依赖项的 setter 触发时，会通知watcher，从而使它关联的组件重新渲染。

##### 二、data的处理

自定义策略中会对data进行处理，处理会区分父子选项，处理的函数是同一个，但为了区分父子传递的参数有所不同。如果是处理根实例，会添加vm参数作为传递

```js
	strats.data = function(parentVal, childVal, vm) {
		if (!vm) {
			if (childVal && typeof childVal !== "function") {
				console.error("data选项应该为函数 返回组件中每个实例的值")
			}
			//处理子组件data的选项
			return mergeDataOrFn(parentVal, childVal)
		}
		//处理根实例data的选项
		return mergeDataOrFn(parentVal, childVal, vm)
	}

	function mergeDataOrFn(parentVal, childVal, vm) {
		if (!vm) {
			//1: 子组件中的parentVal childVal 都应该是函数
			/*
			会遇到的情况:
			1: parentVal === undefined   return childVal
			2: childVal === undefined   return parentVal
			3: parentVal ===  function(){}  childVal ===  function(){}  mergeData  把两者的返回值对象合并成一个
			*/
		} else {
			return function mergedInstanceDataFn() {
				return typeof childVal === 'function' ? childVal.call(vm, vm) : childVal;
			}
		}
	}
```

